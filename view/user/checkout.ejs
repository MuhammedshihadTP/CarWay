<%-include('../partials/heder.ejs') %>
<section class="shop checkout section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-12">
        <div class="checkout-form">
          <h2>Make Your Checkout Here</h2>
          <p>Please register in order to checkout more quickly</p>
          <!-- Form -->
          <form class="form" method="post" action="">
            <div class="row">
              <div class="col-lg-6 col-md-6 col-12">
                <div class="form-group">
                  <label>Full name<span>*</span></label>
                  <input type="text"  id="fullname" value="<%=username%>" required="required" />
                </div>
              </div>

              <div class="col-lg-6 col-md-6 col-12">
                <div class="form-group">
                  <label>Email Address<span>*</span></label>
                  <input type="email"  id="email" value="<%=email%>" required="required" />
                </div>
              </div>
              <!-- <div class="col-lg-6 col-md-6 col-12">
                <div class="form-group">
                  <label>Vehicle Name<span>*</span></label>
                  <input type="text" name="vehiclename" id="vehiclename" value="" required="required" />
                </div>
              </div> -->
              <div class="col-lg-6 col-md-6 col-12">
                <div class="form-group">
                  <label>Phone Number<span>*</span></label>
                  <input type="tel" maxlength="10"  id="number" placeholder="" required="required" />
                </div>
              </div>
              <div class="col-lg-6 col-md-6 col-12">
                <div class="form-group">
                  <label>Address <span>*</span></label>
                  <input type="text"  id="address" placeholder="" required="required" />
                </div>
              </div>
              <div class="col-lg-6 col-md-6 col-12">
                <div class="form-group">
                  <label>Licence Number<span>*</span></label>
                  <input type="text" id="Lice" placeholder="" required="required" />
                </div>
              </div>
          

              <div class="col-lg-6 col-md-6 col-12">
                <div class="order-details">
                  <!-- Order Widget -->
                  <div class="single-widget">
                    <h2>TOTALS</h2>
                    <div class="content">
                      <ul>
                        <li>Vehicle Name:<span id="Vname"><%=time.name %></span></li>
                        <li>From :<span id="start"><%=time.start %></span></li>
                        <li>To :<span id="End"><%=time.end %></span></li>

                        <li class="last">Total Amount : â‚¹<span id="totale"> <%=time.total %> </span></li>
                      </ul>
                    </div>
                  </div>

                  <div class="single-widget payement">
                    <div class="content">
                      <img src="/images/payment-method.png" alt="#" />
                    </div>
                  </div>
                  <!--/ End Payment Method Widget -->
                  <!-- Button Widget -->
                  <div class="single-widget get-button">
                    <div class="content">
                      <div class="button">
                        <a ><button id="checkout"  type="button"   class="btn">proceed to
                            checkout</button></a>
                      </div>
                    </div>
                  </div>
                  <!--/ End Button Widget -->
                </div>
              </div>
            </div>
        </div>
        </form>
        <!--/ End Form -->
      </div>
    </div>

  </div>
  </div>
</section>
<%-include('../partials/footer.ejs') %>
<!--/ End Checkout -->
<script>
  // function selectTimeslote() {
  //   const from = document.getElementById("start");
  //   const to = document.getElementById("end");

  //   const diffrence = new Date(to.value) - new Date(from.value);
  //   var hours = diffrence / (1000 * 60 * 60);

  //   document.getElementById("totalhours").innerHTML = hours;

  //   console.log(hours);
  //   const rupee = document.getElementById("price").innerText;
  //   console.log(rupee);

  //   const total = (hours * rupee)
  //   document.getElementById('totale').innerHTML = total
  //   console.log(total);
  // }

  //   function clicked(){
  //     Swal.fire({
  //   title: 'Click The Cheack Out Boutton',
  //   showClass: {
  //     popup: 'animate__animated animate__fadeInDown'
  //   },
  //   hideClass: {
  //     popup: 'animate__animated animate__fadeOutUp'
  //   }
  // })
  //   }

  const buttoun = document.querySelector("#checkout")
  buttoun.addEventListener('click', () => {
  const Name=document.getElementById("fullname").value;
  const Email=document.getElementById("email").value;
  const phoneNo=document.getElementById("number").value;
  const Address=document.getElementById("address").value;
  const lice=document.getElementById('Lice').value;
  const vName=document.getElementById("Vname").innerText
  const start=document.getElementById("start").innerText
  const end=document.getElementById("End").innerText
  const total=document.getElementById("totale").innerText
  console.log(Name,Email,phoneNo,Address,lice);

if(Name!=='' && Email!=='' && Address!=='' && phoneNo!=='' && lice!=='' ){
  fetch("http://localhost:3000/cheackout", {
        headers: {
          'Content-Type': 'application/json'
        },
        method: "POST",
        body: JSON.stringify({
          vehicles: {
            name: Name,
            email:Email,
            phone:parseInt(phoneNo),
            address:Address,
            lice:lice,
            vname:vName,
            start:start,
            end:end,
            amount:parseInt(total),

            // image: '',
            // amount: parseInt(rupee),
            // "quantity": 1
          }
        })
      })
      .then(function(response) {
        // console.log(response.id,"payment");
        return response.json().then(json=> Promise.resolve(json))
       
      }).then(({url})=>{
        // console.log(url,"done");
        window.location = url
      }).catch(error=>{
        console.log(error.url,"koyappam");
      })
      
}else{
  const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 5000,
            timerProgressBar: true,
            didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
            })
            Toast.fire({
            icon: 'error',
            title: 'Please Fill The Field'
            })

}
   


  })
</script>